<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Kho Ph√¢n Quy·ªÅn & H√¨nh ·∫¢nh</title>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Login Form */
        #login-screen { max-width: 400px; margin: 100px auto; text-align: center; }
        .input-group { margin-bottom: 15px; text-align: left; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        button { cursor: pointer; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; color: white; transition: 0.3s; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--danger); }

        /* Dashboard */
        .nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--dark); color: white; padding: 10px 20px; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        
        /* Product Card */
        .prod-card { background: white; border-radius: 8px; overflow: hidden; border: 1px solid #eee; position: relative; }
        .prod-img { width: 100%; height: 180px; object-fit: cover; background: #eee; }
        .prod-info { padding: 15px; }
        .badge { padding: 3px 8px; border-radius: 10px; font-size: 12px; color: white; }
        
        /* Modal & Tabs */
        .hidden { display: none !important; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; }

        .confirm-tag { background: var(--warning); color: black; padding: 2px 5px; border-radius: 3px; font-size: 11px; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="card">
        <h2>üîë ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng</h2>
        <div class="input-group">
            <label>T√†i kho·∫£n:</label>
            <input type="text" id="user-input" placeholder="admin ho·∫∑c nhanvien">
        </div>
        <div class="input-group">
            <label>M·∫≠t kh·∫©u:</label>
            <input type="password" id="pass-input" placeholder="123">
        </div>
        <button class="btn-blue" onclick="handleLogin()" style="width: 100%">ƒêƒÉng Nh·∫≠p</button>
        <p style="font-size: 12px; color: #666; margin-top: 10px;">Admin: <b>admin/123</b> | Nh√¢n vi√™n: <b>nv1/123</b></p>
    </div>

    <div id="main-screen" class="hidden">
        <div class="nav">
            <span id="welcome-user">Ch√†o m·ª´ng, Admin</span>
            <button class="btn-red" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
        </div>

        <div class="tabs">
            <button class="btn-blue" onclick="showSection('inventory')">üì¶ Kho & Order</button>
            <button class="btn-green admin-only" onclick="showSection('import')">‚ûï Nh·∫≠p H√†ng</button>
            <button class="btn-blue admin-only" onclick="showSection('confirm')">üîî Duy·ªát Xu·∫•t Kho (<span id="pending-count">0</span>)</button>
        </div>

        <hr style="margin: 20px 0;">

        <div id="sec-inventory" class="section">
            <h3>Danh S√°ch S·∫£n Ph·∫©m</h3>
            <div class="grid" id="product-grid">
                </div>
        </div>

        <div id="sec-import" class="section hidden">
            <div class="card">
                <h3>Th√™m S·∫£n Ph·∫©m M·ªõi</h3>
                <div class="input-group"><label>T√™n s·∫£n ph·∫©m:</label><input type="text" id="in-name"></div>
                <div class="input-group"><label>Gi√° b√°n:</label><input type="number" id="in-price"></div>
                <div class="input-group"><label>S·ªë l∆∞·ª£ng:</label><input type="number" id="in-qty"></div>
                <div class="input-group"><label>Link h√¨nh ·∫£nh (URL):</label><input type="text" id="in-img" placeholder="https://abc.com/anh.jpg"></div>
                <button class="btn-green" onclick="addProduct()">L∆∞u v√†o kho</button>
            </div>
        </div>

        <div id="sec-confirm" class="section hidden">
            <div class="card">
                <h3>Y√™u C·∫ßu Ch·ªù Duy·ªát</h3>
                <table>
                    <thead>
                        <tr>
                            <th>S·∫£n ph·∫©m</th>
                            <th>S·ªë l∆∞·ª£ng</th>
                            <th>Ng∆∞·ªùi Order</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="pending-table"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // D·ªÆ LI·ªÜU M·∫™U
    let products = JSON.parse(localStorage.getItem('pro_products')) || [];
    let pendingOrders = JSON.parse(localStorage.getItem('pro_pending')) || [];
    let currentUser = null;

    // 1. QU·∫¢N L√ù ƒêƒÇNG NH·∫¨P
    function handleLogin() {
        const user = document.getElementById('user-input').value;
        const pass = document.getElementById('pass-input').value;

        if (pass === '123') {
            currentUser = { username: user, role: user === 'admin' ? 'admin' : 'staff' };
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('welcome-user').innerText = `T√†i kho·∫£n: ${user.toUpperCase()} (${currentUser.role})`;
            
            // Ph√¢n quy·ªÅn hi·ªÉn th·ªã
            if(currentUser.role !== 'admin') {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.add('hidden'));
            } else {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
            }
            renderAll();
        } else {
            alert("Sai m·∫≠t kh·∫©u!");
        }
    }

    function handleLogout() {
        location.reload();
    }

    // 2. CHUY·ªÇN PH·∫¶N (TABS)
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById('sec-' + id).classList.remove('hidden');
    }

    // 3. TH√äM S·∫¢N PH·∫®M (ADMIN)
    function addProduct() {
        const name = document.getElementById('in-name').value;
        const price = document.getElementById('in-price').value;
        const qty = document.getElementById('in-qty').value;
        const img = document.getElementById('in-img').value || 'https://via.placeholder.com/150';

        if(!name || !price || !qty) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß!");

        products.push({ id: Date.now(), name, price, qty: Number(qty), img });
        save();
        alert("ƒê√£ th√™m!");
        showSection('inventory');
    }

    // 4. ORDER NHANH (STAFF/ADMIN)
    function quickOrder(id) {
        const p = products.find(x => x.id === id);
        const qty = prompt(`B·∫°n mu·ªën order bao nhi√™u ${p.name}? (T·ªìn: ${p.qty})`);
        
        if (qty && Number(qty) <= p.qty) {
            pendingOrders.push({
                id: Date.now(),
                prodId: p.id,
                prodName: p.name,
                qty: Number(qty),
                user: currentUser.username
            });
            save();
            alert("ƒê√£ g·ª≠i y√™u c·∫ßu xu·∫•t h√†ng. Ch·ªù Admin duy·ªát!");
            renderAll();
        } else {
            alert("S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá!");
        }
    }

    // 5. DUY·ªÜT XU·∫§T H√ÄNG (ADMIN ONLY)
    function confirmOrder(orderId, approve) {
        const idx = pendingOrders.findIndex(o => o.id === orderId);
        const order = pendingOrders[idx];

        if (approve) {
            const pIdx = products.findIndex(p => p.id === order.prodId);
            if (products[pIdx].qty >= order.qty) {
                products[pIdx].qty -= order.qty;
                alert("ƒê√£ duy·ªát xu·∫•t kho!");
            } else {
                alert("L·ªói: Kho kh√¥ng ƒë·ªß h√†ng!");
            }
        }
        
        pendingOrders.splice(idx, 1);
        save();
        renderAll();
    }

    // 6. HI·ªÇN TH·ªä D·ªÆ LI·ªÜU
    function renderAll() {
        // Render Kho
        const grid = document.getElementById('product-grid');
        grid.innerHTML = products.map(p => `
            <div class="prod-card">
                <img src="${p.img}" class="prod-img">
                <div class="prod-info">
                    <strong>${p.name}</strong><br>
                    <span style="color:var(--danger)">${Number(p.price).toLocaleString()}ƒë</span><br>
                    T·ªìn kho: <b style="color:${p.qty < 5 ? 'red' : 'green'}">${p.qty}</b><br><br>
                    <button class="btn-blue" onclick="quickOrder(${p.id})" style="width:100%">Order Nhanh</button>
                </div>
            </div>
        `).join('');

        // Render Ch·ªù duy·ªát
        document.getElementById('pending-count').innerText = pendingOrders.length;
        const table = document.getElementById('pending-table');
        table.innerHTML = pendingOrders.map(o => `
            <tr>
                <td>${o.prodName}</td>
                <td><b>${o.qty}</b></td>
                <td>${o.user}</td>
                <td>
                    <button class="btn-green" onclick="confirmOrder(${o.id}, true)">Duy·ªát</button>
                    <button class="btn-red" onclick="confirmOrder(${o.id}, false)">H·ªßy</button>
                </td>
            </tr>
        `).join('');
    }

    function save() {
        localStorage.setItem('pro_products', JSON.stringify(products));
        localStorage.setItem('pro_pending', JSON.stringify(pendingOrders));
        renderAll();
    }
</script>
</body>
</html>