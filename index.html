<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Kho Ph√¢n Quy·ªÅn & H√¨nh ·∫¢nh N·ªôi B·ªô</title>
    <style>
        :root { --primary: #3498db; --success: #27ae60; --danger: #e74c3c; --warning: #f1c40f; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* Forms */
        #login-screen { max-width: 400px; margin: 100px auto; text-align: center; }
        .input-group { margin-bottom: 15px; text-align: left; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        button { cursor: pointer; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; color: white; transition: 0.3s; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--danger); }
        button:hover { opacity: 0.8; }

        /* Dashboard */
        .nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: var(--dark); color: white; padding: 10px 20px; border-radius: 8px; }
        .tabs { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        
        /* Product Card */
        .prod-card { background: white; border-radius: 8px; overflow: hidden; border: 1px solid #eee; transition: 0.3s; }
        .prod-img { width: 100%; height: 180px; object-fit: cover; background: #eee; }
        .prod-info { padding: 15px; }
        
        .hidden { display: none !important; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; }
        
        #img-preview { max-width: 150px; margin-top: 10px; border: 1px dashed #ccc; border-radius: 5px; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen" class="card">
        <h2>üîë ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng</h2>
        <div class="input-group"><input type="text" id="user-input" placeholder="T√†i kho·∫£n"></div>
        <div class="input-group"><input type="password" id="pass-input" placeholder="M·∫≠t kh·∫©u"></div>
        <button class="btn-blue" onclick="handleLogin()" style="width: 100%">ƒêƒÉng Nh·∫≠p</button>
    </div>

    <div id="main-screen" class="hidden">
        <div class="nav">
            <span id="welcome-user">Ch√†o m·ª´ng</span>
            <button class="btn-red" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
        </div>

        <div class="tabs">
            <button class="btn-blue" onclick="showSection('inventory')">üì¶ Kho h√†ng</button>
            <button class="btn-green admin-only" onclick="showSection('import')">‚ûï Nh·∫≠p h√†ng</button>
            <button class="btn-blue admin-only" onclick="showSection('confirm')">üîî Duy·ªát (<span id="pending-count">0</span>)</button>
            <button class="btn-red admin-only" onclick="showSection('users')">üë• T√†i kho·∫£n</button>
            <button class="btn-blue" onclick="showSection('profile')">‚öôÔ∏è C√†i ƒë·∫∑t</button>
        </div>

        <div id="sec-inventory" class="section">
            <div class="card">
                <input type="text" id="search-input" placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m..." onkeyup="renderAll()">
            </div>
            <div class="grid" id="product-grid"></div>
        </div>

        <div id="sec-import" class="section hidden">
            <div class="card">
                <h3>Th√™m S·∫£n Ph·∫©m M·ªõi</h3>
                <div class="input-group"><label>T√™n s·∫£n ph·∫©m:</label><input type="text" id="in-name"></div>
                <div class="input-group"><label>Gi√° b√°n:</label><input type="number" id="in-price"></div>
                <div class="input-group"><label>S·ªë l∆∞·ª£ng:</label><input type="number" id="in-qty"></div>
                <div class="input-group">
                    <label>H√¨nh ·∫£nh (JPG/PNG):</label>
                    <input type="file" id="in-img-file" accept="image/*">
                    <img id="img-preview">
                </div>
                <button class="btn-green" onclick="addProduct()">L∆∞u v√†o kho</button>
            </div>
        </div>

        <div id="sec-confirm" class="section hidden">
            <div class="card">
                <h3>Y√™u C·∫ßu Ch·ªù Duy·ªát</h3>
                <table>
                    <thead><tr><th>S·∫£n ph·∫©m</th><th>SL</th><th>Ng∆∞·ªùi g·ª≠i</th><th>Thao t√°c</th></tr></thead>
                    <tbody id="pending-table"></tbody>
                </table>
            </div>
        </div>

        <div id="sec-users" class="section hidden">
            <div class="card">
                <h3>T·∫°o T√†i Kho·∫£n</h3>
                <div class="input-group"><input type="text" id="new-user" placeholder="T√™n ƒëƒÉng nh·∫≠p"></div>
                <div class="input-group"><input type="password" id="new-pass" placeholder="M·∫≠t kh·∫©u"></div>
                <div class="input-group">
                    <select id="new-role">
                        <option value="staff">Nh√¢n vi√™n (Staff)</option>
                        <option value="admin">Qu·∫£n tr·ªã (Admin)</option>
                    </select>
                </div>
                <button class="btn-green" onclick="registerUser()">T·∫°o t√†i kho·∫£n</button>
            </div>
            <div class="card">
                <h3>Danh S√°ch T√†i Kho·∫£n</h3>
                <table>
                    <thead><tr><th>Username</th><th>Quy·ªÅn</th><th>Thao t√°c</th></tr></thead>
                    <tbody id="user-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="sec-profile" class="section hidden">
            <div class="card" style="max-width: 400px;">
                <h3>ƒê·ªïi M·∫≠t Kh·∫©u</h3>
                <div class="input-group"><label>M·∫≠t kh·∫©u c≈©:</label><input type="password" id="old-pass"></div>
                <div class="input-group"><label>M·∫≠t kh·∫©u m·ªõi:</label><input type="password" id="new-password"></div>
                <div class="input-group"><label>X√°c nh·∫≠n:</label><input type="password" id="confirm-new-pass"></div>
                <button class="btn-blue" onclick="changePassword()">C·∫≠p nh·∫≠t</button>
            </div>
        </div>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('pro_users')) || [
        { username: 'admin', pass: '123', role: 'admin' },
        { username: 'nv1', pass: '123', role: 'staff' }
    ];
    let products = JSON.parse(localStorage.getItem('pro_products')) || [];
    let pendingOrders = JSON.parse(localStorage.getItem('pro_pending')) || [];
    let currentUser = null;

    // HI·ªÇN TH·ªä ·∫¢NH XEM TR∆Ø·ªöC
    document.getElementById('in-img-file').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                const preview = document.getElementById('img-preview');
                preview.src = ev.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    function handleLogin() {
        const u = document.getElementById('user-input').value;
        const p = document.getElementById('pass-input').value;
        const found = users.find(x => x.username === u && x.pass === p);
        if (found) {
            currentUser = found;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            document.getElementById('welcome-user').innerText = `T√†i kho·∫£n: ${found.username.toUpperCase()} (${found.role})`;
            document.querySelectorAll('.admin-only').forEach(el => {
                found.role === 'admin' ? el.classList.remove('hidden') : el.classList.add('hidden');
            });
            renderAll();
        } else { alert("Sai th√¥ng tin!"); }
    }

    function handleLogout() { location.reload(); }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById('sec-' + id).classList.remove('hidden');
    }

    function addProduct() {
        const name = document.getElementById('in-name').value;
        const price = document.getElementById('in-price').value;
        const qty = document.getElementById('in-qty').value;
        const file = document.getElementById('in-img-file').files[0];

        if(!name || !price || !qty || !file) return alert("Thi·∫øu th√¥ng tin ho·∫∑c ·∫£nh!");

        const reader = new FileReader();
        reader.onload = (e) => {
            products.push({ id: Date.now(), name, price, qty: Number(qty), img: e.target.result });
            save();
            document.getElementById('img-preview').style.display = 'none';
            showSection('inventory');
        };
        reader.readAsDataURL(file);
    }

    function quickOrder(id) {
        const p = products.find(x => x.id === id);
        const q = prompt(`S·ªë l∆∞·ª£ng cho ${p.name}:`, "1");
        if (q > 0 && q <= p.qty) {
            pendingOrders.push({ id: Date.now(), prodId: p.id, prodName: p.name, qty: Number(q), user: currentUser.username });
            save();
            alert("ƒê√£ g·ª≠i y√™u c·∫ßu duy·ªát!");
        } else { alert("S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá!"); }
    }

    function confirmOrder(orderId, approve) {
        const idx = pendingOrders.findIndex(o => o.id === orderId);
        if (approve) {
            const pIdx = products.findIndex(p => p.id === pendingOrders[idx].prodId);
            if (products[pIdx].qty >= pendingOrders[idx].qty) {
                products[pIdx].qty -= pendingOrders[idx].qty;
            } else { return alert("Kh√¥ng ƒë·ªß h√†ng!"); }
        }
        pendingOrders.splice(idx, 1);
        save();
    }

    function registerUser() {
        const u = document.getElementById('new-user').value;
        const p = document.getElementById('new-pass').value;
        const r = document.getElementById('new-role').value;
        if(users.some(x => x.username === u)) return alert("User ƒë√£ t·ªìn t·∫°i!");
        users.push({ username: u, pass: p, role: r });
        localStorage.setItem('pro_users', JSON.stringify(users));
        renderAll();
        alert("ƒê√£ t·∫°o!");
    }

    function deleteUser(username) {
        if(username === 'admin') return alert("Kh√¥ng th·ªÉ x√≥a Admin g·ªëc!");
        users = users.filter(u => u.username !== username);
        localStorage.setItem('pro_users', JSON.stringify(users));
        renderAll();
    }

    function changePassword() {
        const old = document.getElementById('old-pass').value;
        const newP = document.getElementById('new-password').value;
        if(old !== currentUser.pass) return alert("Sai m·∫≠t kh·∫©u c≈©!");
        const idx = users.findIndex(u => u.username === currentUser.username);
        users[idx].pass = newP;
        currentUser.pass = newP;
        localStorage.setItem('pro_users', JSON.stringify(users));
        alert("Th√†nh c√¥ng!");
    }

    function renderAll() {
        const key = document.getElementById('search-input')?.value.toLowerCase() || "";
        const isAdmin = currentUser?.role === 'admin';

        // Render Kho
        const filtered = products.filter(p => p.name.toLowerCase().includes(key));
        document.getElementById('product-grid').innerHTML = filtered.map(p => `
            <div class="prod-card">
                <img src="${p.img}" class="prod-img">
                <div class="prod-info">
                    <strong>${p.name}</strong><br>
                    <span style="color:var(--danger)">${Number(p.price).toLocaleString()}ƒë</span><br>
                    T·ªìn: <b style="color:${p.qty < 5 ? 'red' : 'green'}">${p.qty}</b><br><br>
                    <button class="btn-blue" onclick="quickOrder(${p.id})" style="width:70%">Order</button>
                    ${isAdmin ? `<button class="btn-red" onclick="deleteProduct(${p.id})" style="width:25%">X√≥a</button>` : ''}
                </div>
            </div>
        `).join('');

        // Render Duy·ªát
        document.getElementById('pending-count').innerText = pendingOrders.length;
        document.getElementById('pending-table').innerHTML = pendingOrders.map(o => `
            <tr><td>${o.prodName}</td><td>${o.qty}</td><td>${o.user}</td>
            <td><button class="btn-green" onclick="confirmOrder(${o.id}, true)">Duy·ªát</button>
            <button class="btn-red" onclick="confirmOrder(${o.id}, false)">H·ªßy</button></td></tr>
        `).join('');

        // Render Users
        if(isAdmin) {
            document.getElementById('user-table-body').innerHTML = users.map(u => `
                <tr><td>${u.username}</td><td>${u.role}</td>
                <td><button class="btn-red" onclick="deleteUser('${u.username}')">X√≥a</button></td></tr>
            `).join('');
        }
    }

    function deleteProduct(id) {
        if(confirm("X√≥a s·∫£n ph·∫©m n√†y?")) { products = products.filter(p => p.id !== id); save(); }
    }

    function save() {
        localStorage.setItem('pro_products', JSON.stringify(products));
        localStorage.setItem('pro_pending', JSON.stringify(pendingOrders));
        renderAll();
    }
</script>
</body>
</html>
